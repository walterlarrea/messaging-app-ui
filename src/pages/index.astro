---
import '../styles/main.css'
import Layout from '../layouts/Layout.astro'
import Button from '../components/atoms/Button/Button'
import Login from '../components/organisms/Login/Login'
import Input from '../components/atoms/Input/Input'
---

<Layout title="FB Messaging">
	<div class="grid_container gap-[10px] sm:gap-0 h-fit sm:h-full sm:p-[16px]">
		<section class="justify-self-end">
			<Login classes="max-w-fit" client:only />
		</section>
		<section class="flex items-center justify-center">
			<form
				class="flex flex-col w-full sm:max-w-md p-[15px] border-2 border-gray-300 rounded-[20px]"
				id="register-form"
			>
				<Input classes="ms-4 mb-4" id="email" name="email" type="email">
					E-mail
				</Input>

				<Input classes="ms-4 mb-4" id="username" name="username" type="text">
					Username
				</Input>

				<Input classes="ms-4 mb-4" id="firstname" name="first_name" type="text">
					Name
				</Input>

				<Input classes="ms-4 mb-4" id="lastname" name="last_name" type="text">
					Last name
				</Input>

				<Input
					classes="ms-4 mb-4"
					id="password"
					name="password"
					type="password"
				>
					Password
				</Input>

				<Input
					classes="ms-4 mb-4"
					id="passwordconfirm"
					name="password_confirm"
					type="password"
				>
					Repeat password
				</Input>

				<Button classes="w-32 self-end" type="submit">Sign up</Button>
			</form>
		</section>
	</div>
</Layout>

<script>
	import { registerNewUser } from '../services/authService'
	import type { TUserRegister } from '../types/users'

	const loginForm = document.getElementById('register-form') as HTMLFormElement

	loginForm.addEventListener('submit', async (e: SubmitEvent) => {
		e.preventDefault()

		const dataList = new FormData(e.target as HTMLFormElement) as FormData
		const dataObject: TUserRegister = {
			email: dataList.get('email') as string,
			username: dataList.get('username') as string,
			first_name: dataList.get('first_name') as string,
			last_name: dataList.get('last_name') as string,
			password: dataList.get('password') as string,
			password_confirm: dataList.get('password_confirm') as string,
		}

		registerNewUser(dataObject)
			.then((result) => {
				console.log('User registered = ', result)
			})
			.catch((reasons) =>
				reasons?.errors?.[0]
					? alert(reasons?.errors?.[0].msg)
					: alert('An unknown error occur')
			)
	})
</script>

<style>
	.grid_container {
		display: grid;
		grid-template-columns: 1fr;
		grid-template-rows: min-content auto;
	}
</style>
